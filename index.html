<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xonix</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
</head>
<body>
    <script>
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            physics: { default: 'arcade' },
            scene: { preload, create, update }
        };

        let player, cursors, enemies = [], trail = [], capturedArea = 0;
        let gameOver = false, scoreText, graphics, background;
        let lineGraphics, isDrawing = false;

        const game = new Phaser.Game(config);

        function preload() {
            this.load.image('player', 'https://popolzenx86.github.io/zenpop/player.png');
            this.load.image('enemy', 'https://popolzenx86.github.io/zenpop/enemy.png');
            this.load.image('background', 'https://popolzenx86.github.io/zenpop/background.png');
        }

        function create() {
            background = this.add.image(400, 300, 'background');
            background.setAlpha(0); 
            
            this.add.rectangle(400, 300, 800, 600, 0x555555);
            graphics = this.add.graphics({ lineStyle: { width: 2, color: 0xff0000 } });
            lineGraphics = this.add.graphics({ lineStyle: { width: 2, color: 0x00ff00 } });

            player = this.physics.add.sprite(50, 300, 'player').setCollideWorldBounds(true);
            
            for (let i = 0; i < 3; i++) {
                let enemy = this.physics.add.sprite(Phaser.Math.Between(200, 600), Phaser.Math.Between(100, 500), 'enemy');
                enemy.setVelocity(Phaser.Math.Between(-100, 100), Phaser.Math.Between(-100, 100));
                enemy.setBounce(1).setCollideWorldBounds(true);
                enemies.push(enemy);
            }
            
            cursors = this.input.keyboard.createCursorKeys();
            scoreText = this.add.text(20, 20, 'Captured: 0%', { fontSize: '24px', fill: '#fff' });
            this.physics.add.overlap(player, enemies, hitEnemy, null, this);

            this.input.on('pointerdown', () => {
                isDrawing = true;
                trail = [];
            });

            this.input.on('pointerup', () => {
                isDrawing = false;
                checkCapture();
            });
        }

        function update() {
            if (gameOver) return;
            
            player.setVelocity(0);
            if (cursors.left.isDown) player.setVelocityX(-200);
            if (cursors.right.isDown) player.setVelocityX(200);
            if (cursors.up.isDown) player.setVelocityY(-200);
            if (cursors.down.isDown) player.setVelocityY(200);
            
            if (isDrawing) {
                trail.push({ x: player.x, y: player.y });
                drawTrail();
            }
        }

        function drawTrail() {
            lineGraphics.clear();
            lineGraphics.beginPath();
            trail.forEach((point, index) => {
                if (index === 0) {
                    lineGraphics.moveTo(point.x, point.y);
                } else {
                    lineGraphics.lineTo(point.x, point.y);
                }
            });
            lineGraphics.strokePath();
        }

        function hitEnemy(player, enemy) {
            gameOver = true;
            scoreText.setText('Game Over!');
        }

        function checkCapture() {
            if (trail.length < 3) return;

            let area = Phaser.Math.Between(5, 15);
            capturedArea += area;
            scoreText.setText(`Captured: ${capturedArea}%`);
            
            let newAlpha = capturedArea / 100;
            background.setAlpha(newAlpha > 1 ? 1 : newAlpha);
            
            if (capturedArea >= 75) {
                gameOver = true;
                scoreText.setText('You Win!');
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Territory Capture</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
</head>
<body>
    <script>
        const API_URL = "ВАШ_СЕРВЕРНЫЙ_URL";

        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            physics: { default: 'arcade' },
            scene: { preload, create, update }
        };

        let player, cursors, enemies = [], trail = [], capturedArea = 0;
        let gameOver = false, scoreText;

        const game = new Phaser.Game(config);

        function preload() {
            this.load.image('player', 'https://popolzenx86.github.io/zenpop/enemy.png');
            this.load.image('enemy', 'https://i.imgur.com/5uJkrkK.png');
        }

        function create() {
            this.add.rectangle(400, 300, 800, 600, 0x555555);
            player = this.physics.add.sprite(50, 300, 'player').setCollideWorldBounds(true);
            
            for (let i = 0; i < 3; i++) {
                let enemy = this.physics.add.sprite(Phaser.Math.Between(200, 600), Phaser.Math.Between(100, 500), 'enemy');
                enemy.setVelocity(Phaser.Math.Between(-100, 100), Phaser.Math.Between(-100, 100));
                enemy.setBounce(1).setCollideWorldBounds(true);
                enemies.push(enemy);
            }
            
            cursors = this.input.keyboard.createCursorKeys();
            scoreText = this.add.text(20, 20, 'Captured: 0%', { fontSize: '24px', fill: '#fff' });
            this.physics.add.overlap(player, enemies, hitEnemy, null, this);
        }

        function update() {
            if (gameOver) return;
            
            player.setVelocity(0);
            if (cursors.left.isDown) player.setVelocityX(-200);
            if (cursors.right.isDown) player.setVelocityX(200);
            if (cursors.up.isDown) player.setVelocityY(-200);
            if (cursors.down.isDown) player.setVelocityY(200);
            
            trail.push({ x: player.x, y: player.y });
            if (trail.length > 100) trail.shift();
            
            if (Math.random() < 0.01) checkCapture();
        }

        function hitEnemy(player, enemy) {
            gameOver = true;
            scoreText.setText('Game Over!');
            saveScore(capturedArea);
        }

        function checkCapture() {
            let area = Phaser.Math.Between(5, 15);
            capturedArea += area;
            scoreText.setText(`Captured: ${capturedArea}%`);
            if (capturedArea >= 75) {
                gameOver = true;
                scoreText.setText('You Win!');
                saveScore(capturedArea);
            }
        }

        function saveScore(captured) {
            fetch(API_URL, {
                method: "POST",
                body: JSON.stringify({ userId: "12345", captured }),
                headers: { "Content-Type": "application/json" },
            });
        }
    </script>
</body>
</html>
